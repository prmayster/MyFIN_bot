{
  "name": "MyFIN_bot",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1504,
        -32
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Telegram Trigger",
      "webhookId": "YOUR_WEBHOOK_ID_1",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/file/YOUR_TELEGRAM_BOT_TOKEN/{{ $json.result.file_path }}",
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        160,
        -384
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP Request"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        512,
        -240
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Merge"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{$json.message.voice.file_id}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        -384
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Get a file",
      "webhookId": "YOUR_WEBHOOK_ID_2",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.openai.com/v1/audio/transcriptions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer YOUR_OPENAI_API_KEY"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "=file",
              "inputDataFieldName": "=data"
            },
            {
              "name": "model",
              "value": "whisper-1"
            },
            {
              "name": "language",
              "value": "ru"
            },
            {
              "name": "response_format",
              "value": "json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        336,
        -384
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "name": "text",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "name": "user_id",
              "value": "={{ $json.message.from.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        -224
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "sb_publishable_daS1tWSY2UUcuR9BhfT7KA_3qbI2Aia"
            },
            {
              "name": "Authorization",
              "value": "sb_publishable_daS1tWSY2UUcuR9BhfT7KA_3qbI2Aia"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=representation"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"user_id\": \"{{ $json.user_id }}\",\n  \"type\": \"{{ $json.type }}\",\n  \"category\": \"{{ $json.category }}\",\n  \"amount\": {{ $json.amount }},\n  \"description\": \"{{ $json.description }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        848,
        -240
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!\n\n{{ $json.type === 'income' ? '‚ûï –î–æ—Ö–æ–¥' : '‚ûñ –†–∞—Å—Ö–æ–¥' }}\nüè∑Ô∏è {{ $json.category }}\nüí∞ {{ $json.amount }} –≥—Ä–Ω\nüìù {{ $json.description }}\n\n‚ùå –ú–û–ñ–ï–®–¨ –û–¢–ú–ï–ù–ò–¢–¨ –ü–û–°–õ–ï–î–ù–Æ–Æ –û–ü–ï–†–ê–¶–ò–Æ\n    –ù–ê–ñ–ê–í –ö–ù–û–ü–ö–£ –ù–ò–ñ–ï ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ",
                    "additionalFields": {
                      "callback_data": "delete_last"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1216,
        -240
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "name": "type",
              "value": "={{ $('Parse Text').item.json.type }}",
              "type": "string"
            },
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "name": "category",
              "value": "={{ $('Parse Text').item.json.category }}",
              "type": "string"
            },
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "name": "amount",
              "value": "={{ $('Parse Text').item.json.amount }}",
              "type": "number"
            },
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "name": "description",
              "value": "={{ $('Parse Text').item.json.description }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1024,
        -240
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const text = item.json.text.toLowerCase();\n  const result = { \n    user_id: item.json.user_id, \n    type: 'expense',  // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞—Å—Ö–æ–¥\n    category: '–õ–∏—á–Ω–æ–µ',  // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–∏—á–Ω–æ–µ\n    amount: 0, \n    description: item.json.text \n  };\n  \n  // –¢–ò–ü - –î–û–ë–ê–í–õ–ï–ù –ü–†–û–î–ê–õ!\n  if (text.includes('–ø—Ä–æ–¥–∞–ª') || text.includes('–ø–æ–ª—É—á–∏–ª') || text.includes('–ø—Ä–∏–±—ã–ª—å') || text.includes('–∑–∞—Ä–∞–±–æ—Ç–∞–ª')) {\n    result.type = 'income';\n  }\n  \n  // –°—É–º–º–∞\n  const amount = text.match(/(\\d+[.,]?\\d*)/);\n  if (amount) result.amount = parseFloat(amount[1].replace(',', '.'));\n  \n  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ë–ò–ó–ù–ï–° (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)\n  if (text.includes('–±–∏–∑–Ω–µ—Å') || text.includes('–¥–ª—è –±–∏–∑–Ω–µ—Å–∞') || text.includes('—Å—Ç–æ–ª') || \n      text.includes('–æ—Ñ–∏—Å') || text.includes('–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ') || text.includes('—Ä–µ–∫–ª–∞–º–∞')) {\n    result.category = '–ë–∏–∑–Ω–µ—Å';\n  } \n  // –õ–∏—á–Ω–æ–µ\n  else if (text.includes('–ø—Ä–æ–¥—É–∫—Ç') || text.includes('–µ–¥–∞') || text.includes('–ø—Ä–æ–¥—É–∫—Ç—ã')) {\n    result.category = '–õ–∏—á–Ω–æ–µ';\n  }\n  // –î—Ä—É–≥–∏–µ –ª–∏—á–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n  else if (text.includes('–∞—Ä–µ–Ω–¥–∞') || text.includes('—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç') || text.includes('–æ–¥–µ–∂–¥–∞')) {\n    result.category = '–õ–∏—á–Ω–æ–µ';\n  }\n  \n  results.push({ json: result });\n}\n\nreturn results;\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        -240
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Parse Text"
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter').first().json.today_filter }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -112,
        -64
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "report_today",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "REPLACE_WITH_UNIQUE_UUID"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "REPLACE_WITH_UNIQUE_UUID",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "income_today",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "REPLACE_WITH_UNIQUE_UUID",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "expense_today",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "REPLACE_WITH_UNIQUE_UUID",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "balance_all",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "REPLACE_WITH_UNIQUE_UUID",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "reset_balance",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "REPLACE_WITH_UNIQUE_UUID",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "delete_last",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -672,
        160
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        480,
        -64
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Answer Query a callback",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "leftValue": "={{ $json.callback_query }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -496,
        -288
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Is Message"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "leftValue": "={{ $json.message.voice }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -256,
        -304
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "voice or text"
    },
    {
      "parameters": {
        "jsCode": "// –û—Ç–ª–∞–¥–∫–∞: –ø–æ–∫–∞–∂–∏ –í–°–ï –¥–∞–Ω–Ω—ã–µ\nconsole.log('ALL INPUT:', JSON.stringify($input.all(), null, 2));\n\n// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è Supabase –º–∞—Å—Å–∏–≤–∞\nconst transactions = $input.all().map(item => item.json);\n\nlet total_income = 0, total_expense = 0;\nlet transactions_list = '';\n\ntransactions.slice(0, 5).forEach(t => {\n  console.log('Transaction:', t); // –û—Ç–ª–∞–¥–∫–∞\n  const amount = Number(t.amount) || 0;\n  const category = t.category || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n  \n  if (t.type === 'income') total_income += amount;\n  else total_expense += amount;\n  \n  transactions_list += `‚Ä¢ ${amount} –≥—Ä–Ω | ${category}\\n`;\n});\n\nreturn [{\n  total_income,\n  total_expense,\n  balance: total_income - total_expense,\n  records_count: transactions.length,\n  transactions_list,\n  callback_query: $('Telegram Trigger').first().json.callback_query\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        -64
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n",
        "text": "=üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n\nüí∞ –î–æ—Ö–æ–¥—ã: {{ $json.total_income }} –≥—Ä–Ω\nüí∏ –†–∞—Å—Ö–æ–¥—ã: {{ $json.total_expense }} –≥—Ä–Ω\nüí≥ –ë–∞–ª–∞–Ω—Å: {{ $json.balance }} –≥—Ä–Ω\nüìã –ó–∞–ø–∏—Å–µ–π: {{ $json.records_count }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n{{ $json.transactions_list }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        -64
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message1",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        -64
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Today Filter"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        480,
        96
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Answer Query a callback1",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const records = $input.all();\nconst incomes = records.filter(item => item.json.type === 'income');\n\nconst totalIncome = incomes.reduce((sum, item) => sum + parseFloat(item.json.amount || 0), 0);\nconst last5 = incomes.slice(0, 5).map(item => \n  `${item.json.amount} –≥—Ä–Ω | ${item.json.category || '–î–æ—Ö–æ–¥'}`\n).join('\\n‚Ä¢ ') || '–ù–µ—Ç –¥–æ—Ö–æ–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è';\n\nreturn [{\n  json: {\n    title: \"üìà –û–¢–ß–Å–¢ –ü–û –î–û–•–û–î–ê–ú (—Å–µ–≥–æ–¥–Ω—è)\",\n    income: totalIncome.toFixed(0),\n    records: incomes.length,\n    lastOperations: last5\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        96
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter Income').first().json.today_filter }}"
            },
            {
              "name": "type",
              "value": "eq.income"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -112,
        96
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Income Report"
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        96
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Today Filter Income"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n\n",
        "text": "=üìà –û–¢–ß–Å–¢ –ü–û –î–û–•–û–î–ê–ú –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n\nüí∞ –î–æ—Ö–æ–¥—ã: {{ $json.income }} –≥—Ä–Ω\nüìä –ó–∞–ø–∏—Å–µ–π: {{ $json.records }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n‚Ä¢ {{ $json.lastOperations }}\n",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        96
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message2",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        480,
        256
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Answer Query a callback2",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const records = $input.all();\nconst expenses = records.filter(item => item.json.type === 'expense');\n\nconst totalExpense = expenses.reduce((sum, item) => sum + parseFloat(item.json.amount || 0), 0);\nconst last5 = expenses.slice(0, 5).map(item => \n  `${item.json.amount} –≥—Ä–Ω | ${item.json.category || '–†–∞—Å—Ö–æ–¥'}`\n).join('\\n‚Ä¢ ') || '–ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è';\n\nreturn [{\n  json: {\n    title: \"üìâ –û–¢–ß–Å–¢ –ü–û –†–ê–°–•–û–î–ê–ú (—Å–µ–≥–æ–¥–Ω—è)\",\n    expense: totalExpense.toFixed(0),\n    records: expenses.length,\n    lastOperations: last5\n  }\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        256
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n\n",
        "text": "=üìâ –û–¢–ß–Å–¢ –ü–û –†–ê–°–•–û–î–ê–ú –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n\nüí∏ –†–∞—Å—Ö–æ–¥—ã: {{ $json.expense }} –≥—Ä–Ω\nüìä –ó–∞–ø–∏—Å–µ–π: {{ $json.records }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n‚Ä¢ {{ $json.lastOperations }}\n",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        256
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message3",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter Expense').first().json.today_filter }}"
            },
            {
              "name": "type",
              "value": "eq.expense"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -112,
        256
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Expense Report"
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        256
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Today Filter Expense"
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter1').first().json.today_filter }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -112,
        432
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        480,
        432
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Answer Query a callback3",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –û—Ç–ª–∞–¥–∫–∞: –ø–æ–∫–∞–∂–∏ –í–°–ï –¥–∞–Ω–Ω—ã–µ\nconsole.log('ALL INPUT:', JSON.stringify($input.all(), null, 2));\n\n// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è Supabase –º–∞—Å—Å–∏–≤–∞\nconst transactions = $input.all().map(item => item.json);\n\nlet total_income = 0, total_expense = 0;\nlet transactions_list = '';\n\ntransactions.slice(0, 5).forEach(t => {\n  console.log('Transaction:', t); // –û—Ç–ª–∞–¥–∫–∞\n  const amount = Number(t.amount) || 0;\n  const category = t.category || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n  \n  if (t.type === 'income') total_income += amount;\n  else total_expense += amount;\n  \n  transactions_list += `‚Ä¢ ${amount} –≥—Ä–Ω | ${category}\\n`;\n});\n\nreturn [{\n  total_income,\n  total_expense,\n  balance: total_income - total_expense,\n  records_count: transactions.length,\n  transactions_list,\n  callback_query: $('Telegram Trigger').first().json.callback_query\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        432
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n",
        "text": "=üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç\n\nüí∞ –î–æ—Ö–æ–¥—ã: {{ $json.total_income }} –≥—Ä–Ω\nüí∏ –†–∞—Å—Ö–æ–¥—ã: {{ $json.total_expense }} –≥—Ä–Ω\nüí≥ –ë–∞–ª–∞–Ω—Å: {{ $json.balance }} –≥—Ä–Ω\nüìã –ó–∞–ø–∏—Å–µ–π: {{ $json.records_count }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n{{ $json.transactions_list }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  },
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        432
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message4",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -288,
        432
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Today Filter1"
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.chat.id }}",
        "text": "=üéâ **–ü–†–ò–í–ï–¢**\n–Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫.\n–û—Ç–ø—Ä–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è,\n—Å —Ç–≤–æ–∏–º–∏ –î–û–•–û–î–ê–ú–ò –∏–ª–∏ –†–ê–°–•–û–î–ê–ú–ò.\n\n**–Ø –í–°–ï–ì–î–ê –ì–û–¢–û–í –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –¢–ï–ë–ï**\n‚Ä¢ **üìä –û–¢–ß–Å–¢ –∑–∞ —Å–µ–≥–æ–¥–Ω—è**\n‚Ä¢ **üí∞ –î–û–•–û–î –∑–∞ —Å–µ–≥–æ–¥–Ω—è**  \n‚Ä¢ **üí∏ –†–ê–°–•–û–î–´ –∑–∞ —Å–µ–≥–æ–¥–Ω—è**\n‚Ä¢ **üìä –ë–ê–õ–ê–ù–°** - –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1088,
        -48
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message5",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -912,
        -48
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Wait",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
        "text": "=‚úÖ **–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**\n–ù–ê–ß–ù–ò –§–ò–ö–°–ò–†–û–í–ê–¢–¨ –°–í–û–ò –§–ò–ù–ê–ù–°–´\n\nüí° **–ü–†–ò–ú–ï–†–´ –≥–æ–ª–æ—Å–æ–≤—ã–π/—Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**\n‚Ä¢ `–∫—É–ø–∏–ª–ª –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ 1500` - üí∏–†–ê–°–•–û–î 1500 –≥—Ä–Ω\n‚Ä¢ `–ø—Ä–æ–¥–∞–ª —Ç–æ–≤–∞—Ä –Ω–∞ 2500` - üí∞–î–û–•–û–î 2500 –≥—Ä–Ω  \n‚Ä¢ `–ø–æ–ª—É—á–∏–ª –ø—Ä–∏–±—ã–ª—å —Å –±–∏–∑–Ω–µ—Å–∞ 800` - üí∞–î–û–•–û–î –±–∏–∑–Ω–µ—Å 800 –≥—Ä–Ω",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -752,
        -48
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message6",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "REPLACE_WITH_UNIQUE_UUID",
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "/start",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1312,
        -32
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "If sistem messeg"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}",
        "text": "=üóëÔ∏è **–ü–û–°–õ–ï–î–ù–Ø–Ø –û–ü–ï–†–ê–¶–ò–Ø –£–î–ê–õ–ï–ù–ê**\n\n‚úÖ –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  },
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        768
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message7",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n",
        "text": "=‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω—É–ª—ë–Ω! –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã.\nüì§ –ì–æ—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º –∑–∞–ø–∏—Å—è–º.\n    –ù–ê–ß–ù–ò–¢–ï –í–ù–û–°–ò–¢–¨ –î–ê–ù–ù–´–ï",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -112,
        608
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Send a text message8",
      "webhookId": "REPLACE_WITH_UNIQUE_UUID",
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "YOUR_BOT_NAME"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const inputData = $input.first().json;\nreturn [{ \n  json: { \n    id: inputData.id || '',\n    amount: inputData.amount || 0,\n    type: inputData.type || '',\n    category: inputData.category || ''\n  } \n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        768
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -288,
        608
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP ziro balans"
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "=eq.{{ $json.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "return",
              "value": "minimal"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        80,
        768
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP DELETE last"
    },
    {
      "parameters": {
        "url": "https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "1"
            },
            {
              "name": "user_id",
              "value": "={{ 'eq.' + $json.callback_query.from.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -288,
        768
      ],
      "id": "REPLACE_WITH_UNIQUE_UUID",
      "name": "HTTP GET last"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If sistem messeg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Parse Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Text": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        []
      ]
    },
    "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫": {
      "main": [
        [
          {
            "node": "Today Filter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Today Filter Income",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Today Filter Expense",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Today Filter1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP ziro balans",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP GET last",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Answer Query a callback": {
      "main": [
        []
      ]
    },
    "Is Message": {
      "main": [
        [
          {
            "node": "voice or text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "voice or text": {
      "main": [
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message1": {
      "main": [
        [
          {
            "node": "Answer Query a callback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Income Report": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter Income": {
      "main": [
        [
          {
            "node": "Income Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message2": {
      "main": [
        [
          {
            "node": "Answer Query a callback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message3": {
      "main": [
        [
          {
            "node": "Answer Query a callback2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Expense Report": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter Expense": {
      "main": [
        [
          {
            "node": "Expense Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Send a text message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message4": {
      "main": [
        [
          {
            "node": "Answer Query a callback3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter1": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message5": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Send a text message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message6": {
      "main": [
        []
      ]
    },
    "If sistem messeg": {
      "main": [
        [
          {
            "node": "Send a text message5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Message",
            "type": "main",
            "index": 0
          },
          {
            "node": "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "HTTP DELETE last",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP ziro balans": {
      "main": [
        [
          {
            "node": "Send a text message8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP DELETE last": {
      "main": [
        [
          {
            "node": "Send a text message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP GET last": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "REPLACE_WITH_UNIQUE_UUID",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d85d386a93ac23e5cda75afc884daa414066b5c356a591bc9c769d8a7119bd79"
  },
  "id": "wYhcp5ye30eXRYRT",
  "tags": []
}
