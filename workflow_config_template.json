/*
 * n8n Workflow Configuration Template
 * 
 * IMPORTANT: Replace all placeholder values before importing this workflow into n8n
 * 
 * Template Placeholders to Replace:
 * - YOUR_NODE_UUID_1, YOUR_NODE_UUID_2, YOUR_NODE_UUID_3: Replace with unique UUIDs for each node
 * - YOUR_WEBHOOK_UUID_1, YOUR_WEBHOOK_UUID_2: Replace with your n8n webhook UUIDs
 * - YOUR_TELEGRAM_API_ID_1, YOUR_TELEGRAM_API_ID_2: Replace with your Telegram Bot API credentials
 * - YOUR_ASSIGNMENT_UUID_1, YOUR_ASSIGNMENT_UUID_2: Replace with unique UUIDs for assignments
 * - YOUR_VERSION_UUID: Replace with a unique version UUID
 * - YOUR_INSTANCE_ID: Replace with your n8n instance ID
 * - YOUR_WORKFLOW_ID: Replace with a unique workflow ID
 * 
 * You can generate UUIDs using online tools or command: uuidgen (Linux/Mac) or [guid]::NewGuid() (PowerShell)
 */

{
  "name": "MyFIN_bot",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1488,
        352
      ],
      "id": "YOUR_NODE_UUID_1",
      "name": "Telegram Trigger",
      "webhookId": "YOUR_WEBHOOK_UUID_1",      "credentials": {
        "telegramApi": {
        "id": "YOUR_TELEGRAM_API_ID_2",          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        528,
        144
      ],
      "id": "YOUR_NODE_UUID_3",
      "name": "Merge"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{$json.message.voice.file_id}}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "5032199b-d915-432a-91ca-0f7e85431d8e",
      "name": "Get a file",
      "webhookId": "4647baa0-e6b6-4a10-8afa-7e94d8bd6ff5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "56f41a52-246a-4a5e-a484-fdfc3da8d7bc",
              "name": "text",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "YOUR_ASSIGNMENT_UUID_2",
              "name": "user_id",
              "value": "={{ $json.message.from.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        160
      ],
      "id": "e41e99f1-564f-451b-b458-5fa64aa22d32",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!\n\n{{ $json.type === 'income' ? '‚ûï –î–æ—Ö–æ–¥' : '‚ûñ –†–∞—Å—Ö–æ–¥' }}\nüè∑Ô∏è {{ $json.category }}\nüí∞ {{ $json.amount }} –≥—Ä–Ω\nüìù {{ $json.description }}\n\n‚ùå –ú–û–ñ–ï–®–¨ –û–¢–ú–ï–ù–ò–¢–¨ –ü–û–°–õ–ï–î–ù–Æ–Æ –û–ü–ï–†–ê–¶–ò–Æ\n    –ù–ê–ñ–ê–í –ö–ù–û–ü–ö–£ –ù–ò–ñ–ï ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ",
                    "additionalFields": {
                      "callback_data": "delete_last"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1232,
        144
      ],
      "id": "7c2252dc-8af3-4ad2-97a0-9bfcdf277261",
      "name": "Send a text message",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "56f41a52-246a-4a5e-a484-fdfc3da8d7bc",
              "name": "type",
              "value": "={{ $('Parse Text').item.json.type }}",
              "type": "string"
            },
            {
              "id": "YOUR_ASSIGNMENT_UUID_2",
              "name": "category",
              "value": "={{ $('Parse Text').item.json.category }}",
              "type": "string"
            },
            {
              "id": "6708307d-6067-41e3-ba79-94e5e037d146",
              "name": "amount",
              "value": "={{ $('Parse Text').item.json.amount }}",
              "type": "number"
            },
            {
              "id": "9001b438-4e6f-4e0a-b6f6-863def0802a4",
              "name": "description",
              "value": "={{ $('Parse Text').item.json.description }}",
              "type": "string"
            },
            {
              "id": "c41104b1-6274-4fca-a313-2a7ed0274e4c",
              "name": "user_id",
              "value": "={{ $json.user_id }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1040,
        144
      ],
      "id": "a5246f5a-bb11-4d70-a47b-3e8d28f9b116",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const text = item.json.text.toLowerCase();\n  const result = { \n    user_id: item.json.user_id, \n    type: 'expense',  // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞—Å—Ö–æ–¥\n    category: '–õ–∏—á–Ω–æ–µ',  // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª–∏—á–Ω–æ–µ\n    amount: 0, \n    description: item.json.text \n  };\n  \n  // –¢–ò–ü - –î–û–ë–ê–í–õ–ï–ù –ü–†–û–î–ê–õ!\n  if (text.includes('–ø—Ä–æ–¥–∞–ª') || text.includes('–ø–æ–ª—É—á–∏–ª') || text.includes('–ø—Ä–∏–±—ã–ª—å') || text.includes('–∑–∞—Ä–∞–±–æ—Ç–∞–ª')) {\n    result.type = 'income';\n  }\n  \n  // –°—É–º–º–∞\n  const amount = text.match(/(\\d+[.,]?\\d*)/);\n  if (amount) result.amount = parseFloat(amount[1].replace(',', '.'));\n  \n  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ë–ò–ó–ù–ï–° (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)\n  if (text.includes('–±–∏–∑–Ω–µ—Å') || text.includes('–¥–ª—è –±–∏–∑–Ω–µ—Å–∞') || text.includes('—Å—Ç–æ–ª') || \n      text.includes('–æ—Ñ–∏—Å') || text.includes('–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ') || text.includes('—Ä–µ–∫–ª–∞–º–∞')) {\n    result.category = '–ë–∏–∑–Ω–µ—Å';\n  } \n  // –õ–∏—á–Ω–æ–µ\n  else if (text.includes('–ø—Ä–æ–¥—É–∫—Ç') || text.includes('–µ–¥–∞') || text.includes('–ø—Ä–æ–¥—É–∫—Ç—ã')) {\n    result.category = '–õ–∏—á–Ω–æ–µ';\n  }\n  // –î—Ä—É–≥–∏–µ –ª–∏—á–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n  else if (text.includes('–∞—Ä–µ–Ω–¥–∞') || text.includes('—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç') || text.includes('–æ–¥–µ–∂–¥–∞')) {\n    result.category = '–õ–∏—á–Ω–æ–µ';\n  }\n  \n  results.push({ json: result });\n}\n\n// –î–æ–±–∞–≤–ª—è–µ–º user_id –≤ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç results\nfor (let item of results) {\n  // –î–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ—Ä—ë–º –∏–∑ Set user_id, –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö - –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ $json\n  item.json.user_id = $('Set user_id').isExecuted \n    ? $('Set user_id').first().json.user_id \n    : $input.first().json.user_id;\n}\n\nreturn results;\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        704,
        144
      ],
      "id": "ff20f5b4-8d10-491d-8995-3b2b6695749f",
      "name": "Parse Text"
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter').first().json.today_filter }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -96,
        320
      ],
      "id": "5ceb0e3b-a173-467e-89ba-f7cce615b40a",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "report_today",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "1a93937e-0e92-49ff-ae99-bdca7b92be7d"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e31ba4ff-2ce6-4c84-9a4e-233530584489",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "income_today",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "57b67848-a5ab-4020-8f5e-74b1aaa9c11f",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "expense_today",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fb6a947a-0d1b-4ac1-ac0c-8377113f9388",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "balance_all",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "17f59a8e-c770-4031-a240-a4582d96fd0d",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "reset_balance",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ce0b115d-fb79-41b1-a5e8-092576dd9ff4",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "delete_last",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -784,
        592
      ],
      "id": "da0086c1-3f10-48c7-8318-59564183509f",
      "name": "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        496,
        320
      ],
      "id": "4d4c35f1-7ad2-4ddd-87d2-8406f68103a4",
      "name": "Answer Query a callback",
      "webhookId": "573f03b2-f69e-4dd0-b4c1-909862571754",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8eebcb6c-f386-4959-8c8b-86d7d17dbce5",
              "leftValue": "={{ $json.callback_query }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -480,
        96
      ],
      "id": "502ab67e-273d-4bcb-b795-dfffc28e7ec6",
      "name": "Is Message"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "11d7aa5a-72ad-495d-b498-f3ec91fcc255",
              "leftValue": "={{ $json.message.voice }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -240,
        80
      ],
      "id": "8c31bfce-f0ed-44a9-9383-395405ba5a26",
      "name": "voice or text"
    },
    {
      "parameters": {
        "jsCode": "// –û—Ç–ª–∞–¥–∫–∞: –ø–æ–∫–∞–∂–∏ –í–°–ï –¥–∞–Ω–Ω—ã–µ\nconsole.log('ALL INPUT:', JSON.stringify($input.all(), null, 2));\n\n// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è Supabase –º–∞—Å—Å–∏–≤–∞\nconst transactions = $input.all().map(item => item.json);\n\nlet total_income = 0, total_expense = 0;\nlet transactions_list = '';\n\ntransactions.slice(0, 5).forEach(t => {\n  console.log('Transaction:', t); // –û—Ç–ª–∞–¥–∫–∞\n  const amount = Number(t.amount) || 0;\n  const category = t.category || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n  \n  if (t.type === 'income') total_income += amount;\n  else total_expense += amount;\n  \n  transactions_list += `‚Ä¢ ${amount} –≥—Ä–Ω | ${category}\\n`;\n});\n\nreturn [{\n  total_income,\n  total_expense,\n  balance: total_income - total_expense,\n  records_count: transactions.length,\n  transactions_list,\n  callback_query: $('Telegram Trigger').first().json.callback_query\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        320
      ],
      "id": "c4abaddd-2cb8-48bf-8ba0-b91ab753bf00",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n",
        "text": "=üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n\nüí∞ –î–æ—Ö–æ–¥—ã: {{ $json.total_income }} –≥—Ä–Ω\nüí∏ –†–∞—Å—Ö–æ–¥—ã: {{ $json.total_expense }} –≥—Ä–Ω\nüí≥ –ë–∞–ª–∞–Ω—Å: {{ $json.balance }} –≥—Ä–Ω\nüìã –ó–∞–ø–∏—Å–µ–π: {{ $json.records_count }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n{{ $json.transactions_list }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        272,
        320
      ],
      "id": "934eabe7-0594-49c7-926f-2a1e30a8f658",
      "name": "Send a text message1",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        320
      ],
      "id": "f29bb974-36d6-4bab-a233-4a41dc4b7899",
      "name": "Today Filter"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        496,
        480
      ],
      "id": "dc306150-95ee-4eb6-bf75-c553af59bb69",
      "name": "Answer Query a callback1",
      "webhookId": "573f03b2-f69e-4dd0-b4c1-909862571754",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const records = $input.all();\nconst incomes = records.filter(item => item.json.type === 'income');\n\nconst totalIncome = incomes.reduce((sum, item) => sum + parseFloat(item.json.amount || 0), 0);\nconst last5 = incomes.slice(0, 5).map(item => \n  `${item.json.amount} –≥—Ä–Ω | ${item.json.category || '–î–æ—Ö–æ–¥'}`\n).join('\\n‚Ä¢ ') || '–ù–µ—Ç –¥–æ—Ö–æ–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è';\n\nreturn [{\n  json: {\n    title: \"üìà –û–¢–ß–Å–¢ –ü–û –î–û–•–û–î–ê–ú (—Å–µ–≥–æ–¥–Ω—è)\",\n    income: totalIncome.toFixed(0),\n    records: incomes.length,\n    lastOperations: last5\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        480
      ],
      "id": "a9a158f0-e54e-4af0-8010-d25e49b1628e",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter Income').first().json.today_filter }}"
            },
            {
              "name": "type",
              "value": "eq.income"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -96,
        480
      ],
      "id": "152c6a24-83c2-4532-bae7-212857c82dba",
      "name": "Income Report"
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        480
      ],
      "id": "2713aaca-71b9-4e9c-a3b7-71a003ff24f8",
      "name": "Today Filter Income"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n\n",
        "text": "=üìà –û–¢–ß–Å–¢ –ü–û –î–û–•–û–î–ê–ú –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n\nüí∞ –î–æ—Ö–æ–¥—ã: {{ $json.income }} –≥—Ä–Ω\nüìä –ó–∞–ø–∏—Å–µ–π: {{ $json.records }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n‚Ä¢ {{ $json.lastOperations }}\n",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        272,
        480
      ],
      "id": "48109bc2-becb-4ba7-928a-63b3d7b00462",
      "name": "Send a text message2",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        496,
        640
      ],
      "id": "6da90797-f20e-47bc-8884-1c0f8f925844",
      "name": "Answer Query a callback2",
      "webhookId": "573f03b2-f69e-4dd0-b4c1-909862571754",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const records = $input.all();\nconst expenses = records.filter(item => item.json.type === 'expense');\n\nconst totalExpense = expenses.reduce((sum, item) => sum + parseFloat(item.json.amount || 0), 0);\nconst last5 = expenses.slice(0, 5).map(item => \n  `${item.json.amount} –≥—Ä–Ω | ${item.json.category || '–†–∞—Å—Ö–æ–¥'}`\n).join('\\n‚Ä¢ ') || '–ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è';\n\nreturn [{\n  json: {\n    title: \"üìâ –û–¢–ß–Å–¢ –ü–û –†–ê–°–•–û–î–ê–ú (—Å–µ–≥–æ–¥–Ω—è)\",\n    expense: totalExpense.toFixed(0),\n    records: expenses.length,\n    lastOperations: last5\n  }\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        640
      ],
      "id": "9664a916-621d-4efa-8f00-0eae12ad5b4e",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n\n",
        "text": "=üìâ –û–¢–ß–Å–¢ –ü–û –†–ê–°–•–û–î–ê–ú –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n\nüí∏ –†–∞—Å—Ö–æ–¥—ã: {{ $json.expense }} –≥—Ä–Ω\nüìä –ó–∞–ø–∏—Å–µ–π: {{ $json.records }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n‚Ä¢ {{ $json.lastOperations }}\n",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        272,
        640
      ],
      "id": "5ea9089f-7599-447f-9d36-255c406c114d",
      "name": "Send a text message3",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            },
            {
              "name": "created_at",
              "value": "=gte.{{ $('Today Filter Expense').first().json.today_filter }}"
            },
            {
              "name": "type",
              "value": "eq.expense"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -96,
        640
      ],
      "id": "cf039393-3e9a-4455-9446-4e68061747bb",
      "name": "Expense Report"
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        640
      ],
      "id": "7e80629c-55ce-4004-908a-a11b691c7757",
      "name": "Today Filter Expense"
    },
    {
      "parameters": {
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "100"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -96,
        816
      ],
      "id": "74d88113-df5c-49fa-86d0-692db5bb6ade",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Telegram Trigger').first().json.callback_query.id }}\n",
        "additionalFields": {
          "show_alert": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        496,
        816
      ],
      "id": "cd4f6fc7-1fdb-4b71-b426-464d68cf1fa5",
      "name": "Answer Query a callback3",
      "webhookId": "573f03b2-f69e-4dd0-b4c1-909862571754",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ –í–°–Å –≤—Ä–µ–º—è\nconst transactions = $input.all().map(item => item.json);\n\nlet total_income = 0, total_expense = 0;\nlet last5 = '';\n\ntransactions.slice(0, 5).forEach(t => {\n  const amount = Number(t.amount) || 0;\n  const category = t.category || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n  const type_emoji = t.type === 'income' ? 'üí∞' : 'üí∏';\n  \n  if (t.type === 'income') total_income += amount;\n  else if (t.type === 'expense') total_expense += amount;\n  \n  last5 += `‚Ä¢ ${amount} –≥—Ä–Ω | ${type_emoji} ${category}\\n`;\n});\n\nconst balance = total_income - total_expense;\n\nreturn [{\n  json: {\n    title: \"üí∞ –û–ë–©–ò–ô –ë–ê–õ–ê–ù–° (–í–°–Å –í–†–ï–ú–Ø)\",\n    income: total_income.toFixed(0),\n    expense: total_expense.toFixed(0),\n    balance: balance.toFixed(0),\n    records: transactions.length,\n    lastOperations: last5 || '–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π'\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        816
      ],
      "id": "d1797d03-e424-4bb5-8dab-7bfa3a9cf436",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n",
        "text": "=üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç\n\nüí∞ –î–æ—Ö–æ–¥—ã: {{ $json.income }} –≥—Ä–Ω\nüí∏ –†–∞—Å—Ö–æ–¥—ã: {{ $json.expense }} –≥—Ä–Ω\nüí≥ –ë–∞–ª–∞–Ω—Å: {{ $json.balance }} –≥—Ä–Ω\nüìã –ó–∞–ø–∏—Å–µ–π: {{ $json.records }}\n\n**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**\n{{ $json.lastOperations }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  },
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        272,
        816
      ],
      "id": "95bd16bf-0045-4a85-bbbd-1da24b875ece",
      "name": "Send a text message4",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const today = new Date();\ntoday.setHours(0, 0, 0, 0);\nconst isoToday = today.toISOString();\n\nreturn [{\n  json: {\n    ...$json,\n    today_filter: isoToday\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        816
      ],
      "id": "d8f0080d-996f-4440-bd3f-f683c0b2628f",
      "name": "Today Filter1"
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.chat.id }}",
        "text": "=üéâ **–ü–†–ò–í–ï–¢**\n–Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫.\n–û—Ç–ø—Ä–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è,\n—Å —Ç–≤–æ–∏–º–∏ –î–û–•–û–î–ê–ú–ò –∏–ª–∏ –†–ê–°–•–û–î–ê–ú–ò.\n\n**–Ø –í–°–ï–ì–î–ê –ì–û–¢–û–í –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –¢–ï–ë–ï**\n‚Ä¢ **üìä –û–¢–ß–Å–¢ –∑–∞ —Å–µ–≥–æ–¥–Ω—è**\n‚Ä¢ **üí∞ –î–û–•–û–î –∑–∞ —Å–µ–≥–æ–¥–Ω—è**  \n‚Ä¢ **üí∏ –†–ê–°–•–û–î–´ –∑–∞ —Å–µ–≥–æ–¥–Ω—è**\n‚Ä¢ **üìä –ë–ê–õ–ê–ù–°** - –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1072,
        336
      ],
      "id": "56786407-56ec-4eb6-ad6c-44cbe197a4e6",
      "name": "Send a text message5",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -896,
        336
      ],
      "id": "be05d3a8-061f-48ea-a447-766614bed2fe",
      "name": "Wait",
      "webhookId": "2793428b-b0ba-4cef-a751-25f5188ee184"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
        "text": "=‚úÖ **–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**\n–ù–ê–ß–ù–ò –§–ò–ö–°–ò–†–û–í–ê–¢–¨ –°–í–û–ò –§–ò–ù–ê–ù–°–´\n\nüí° **–ü–†–ò–ú–ï–†–´ –≥–æ–ª–æ—Å–æ–≤—ã–π/—Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**\n‚Ä¢ `–∫—É–ø–∏–ª–ª –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ 1500` - üí∏–†–ê–°–•–û–î 1500 –≥—Ä–Ω\n‚Ä¢ `–ø—Ä–æ–¥–∞–ª —Ç–æ–≤–∞—Ä –Ω–∞ 2500` - üí∞–î–û–•–û–î 2500 –≥—Ä–Ω  \n‚Ä¢ `–ø–æ–ª—É—á–∏–ª –ø—Ä–∏–±—ã–ª—å —Å –±–∏–∑–Ω–µ—Å–∞ 800` - üí∞–î–û–•–û–î –±–∏–∑–Ω–µ—Å 800 –≥—Ä–Ω",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -736,
        336
      ],
      "id": "b6120148-2342-4908-8bcc-330c2e996da3",
      "name": "Send a text message6",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e17dfc33-dee5-4225-b8b8-37795908322f",
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "/start",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1296,
        352
      ],
      "id": "16e5ee7a-d159-4122-b88a-7511ae9b96ad",
      "name": "If sistem messeg"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}",
        "text": "=üóëÔ∏è **–ü–û–°–õ–ï–î–ù–Ø–Ø –û–ü–ï–†–ê–¶–ò–Ø –£–î–ê–õ–ï–ù–ê**\n\n‚úÖ –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìä –û—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "report_today"
                    }
                  },
                  {
                    "text": "üìà –î–æ—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "income_today"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìâ –†–∞—Å—Ö–æ–¥—ã –∑–∞ –¥–µ–Ω—å",
                    "additionalFields": {
                      "callback_data": "expense_today"
                    }
                  },
                  {
                    "text": "üìä –ë–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "balance_all"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üóëÔ∏è –û–±–Ω—É–ª–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                    "additionalFields": {
                      "callback_data": "reset_balance"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        272,
        1152
      ],
      "id": "df041a71-0f05-46a4-a454-be51472b0c3b",
      "name": "Send a text message7",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}\n",
        "text": "=‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω—É–ª—ë–Ω! –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã.\nüì§ –ì–æ—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º –∑–∞–ø–∏—Å—è–º.\n    –ù–ê–ß–ù–ò–¢–ï –í–ù–û–°–ò–¢–¨ –î–ê–ù–ù–´–ï",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -96,
        992
      ],
      "id": "c65d642c-7288-41ff-a1ab-a530f7167074",
      "name": "Send a text message8",
      "webhookId": "da7658c0-aa99-4a42-84e2-413a03ed72a5",
      "credentials": {
        "telegramApi": {
          "id": "Eo3LhRYGm2zegv3o",
          "name": "MyFin_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const inputData = $input.first().json;\nreturn [{ \n  json: { \n    id: inputData.id || '',\n    amount: inputData.amount || 0,\n    type: inputData.type || '',\n    category: inputData.category || ''\n  } \n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -96,
        1152
      ],
      "id": "8fd733b5-e520-48a7-acc5-17158df8c6f8",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "user_id",
              "value": "=eq.{{ $('Telegram Trigger').first().json.callback_query.from.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -272,
        992
      ],
      "id": "a9f7a365-ddc0-4929-8093-c7b4684e4166",
      "name": "HTTP ziro balans"
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "=eq.{{ $json.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "=apikey",
              "value": "=sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "return",
              "value": "minimal"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        96,
        1152
      ],
      "id": "4e40700e-6995-48e7-b8b2-bccd720b9aae",
      "name": "HTTP DELETE last"
    },
    {
      "parameters": {
        "url": "https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "1"
            },
            {
              "name": "user_id",
              "value": "={{ 'eq.' + $json.callback_query.from.id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            },
            {
              "name": "Authorization",
              "value": "=Bearer sb_secret_yMRQc0A_rs9Q2CqDMFayTw_QaNUWEnt"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -272,
        1152
      ],
      "id": "60662575-1273-4d9e-a7c1-580db1e7df6d",
      "name": "HTTP GET last"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "67d1e2e4-fa32-481d-854d-1092d69c3df1",
              "name": "user_id",
              "value": "={{ $('voice or text').first().json.message.from.id }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        176,
        0
      ],
      "id": "86a2c094-4875-416a-802b-282c72d3fb13",
      "name": "Set user_id"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.openai.com/v1/audio/transcriptions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 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"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "=file",
              "inputDataFieldName": "=data"
            },
            {
              "name": "model",
              "value": "whisper-1"
            },
            {
              "name": "language",
              "value": "ru"
            },
            {
              "name": "response_format",
              "value": "json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        352,
        0
      ],
      "id": "4f449711-4f82-4232-b1b0-befb60801c16",
      "name": "HTTP POST file"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://qwvqoiwgfppvuzobzgvy.supabase.co/rest/v1/transactions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "sb_publishable_daS1tWSY2UUcuR9BhfT7KA_3qbI2Aia"
            },
            {
              "name": "Authorization",
              "value": "sb_publishable_daS1tWSY2UUcuR9BhfT7KA_3qbI2Aia"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=representation"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"user_id\": \"{{ $json.user_id }}\",\n  \"type\": \"{{ $json.type }}\",\n  \"category\": \"{{ $json.category }}\",\n  \"amount\": {{ $json.amount }},\n  \"description\": \"{{ $json.description }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        880,
        144
      ],
      "id": "c7a9f420-43d8-4d14-8127-26628e51b523",
      "name": "HTTP Request"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If sistem messeg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Parse Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "Set user_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Text": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫": {
      "main": [
        [
          {
            "node": "Today Filter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Today Filter Income",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Today Filter Expense",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP ziro balans",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP GET last",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Message": {
      "main": [
        [
          {
            "node": "voice or text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "voice or text": {
      "main": [
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message1": {
      "main": [
        [
          {
            "node": "Answer Query a callback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Income Report": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter Income": {
      "main": [
        [
          {
            "node": "Income Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message2": {
      "main": [
        [
          {
            "node": "Answer Query a callback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message3": {
      "main": [
        [
          {
            "node": "Answer Query a callback2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Expense Report": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter Expense": {
      "main": [
        [
          {
            "node": "Expense Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Send a text message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message4": {
      "main": [
        [
          {
            "node": "Answer Query a callback3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Today Filter1": {
      "main": [
        []
      ]
    },
    "Send a text message5": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Send a text message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If sistem messeg": {
      "main": [
        [
          {
            "node": "Send a text message5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Message",
            "type": "main",
            "index": 0
          },
          {
            "node": "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "HTTP DELETE last",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP ziro balans": {
      "main": [
        [
          {
            "node": "Send a text message8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP DELETE last": {
      "main": [
        [
          {
            "node": "Send a text message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP GET last": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set user_id": {
      "main": [
        [
          {
            "node": "HTTP POST file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP POST file": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "YOUR_VERSION_UUID",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "YOUR_INSTANCE_ID"
  },
  "id": "YOUR_WORKFLOW_ID",
  "tags": []
}
